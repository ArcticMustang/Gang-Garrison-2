<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<event category="DRAW" id="0">
  <actions>
    <action id="603" library="1">
      <!--action name: Code-->
      <kind>CODE</kind>
      <allowRelative>false</allowRelative>
      <question>false</question>
      <canApplyTo>true</canApplyTo>
      <actionType>CODE</actionType>
      <functionName/>
      <relative>false</relative>
      <not>false</not>
      <appliesTo>.self</appliesTo>
      <arguments>
        <argument kind="STRING">var xsize, ysize;

if hidden exit;

xsize = sprite_width;
ysize = sprite_height;

x = view_xview[0] + 45;
y = view_yview[0] + view_hview[0]-sprite_height-85;

draw_set_valign(fa_top);
draw_set_halign(fa_left);
draw_set_color(c_white);
prefixLength = 3 + COLOR_RGB_LENGTH

if isTyping
{
    image_alpha = 1;
}
else
{
    image_alpha = max(alarm[1]/30, 0.2);
}

// Draw the background
draw_sprite(sprite_index, 0, x, y);

// If we're typing something, draw that
if isTyping
{
    var str;
    if blinking_underscore 
    {
        str = keyboard_string+"_";
    }
    else
    {
        str = keyboard_string;
    }
    str = string_replace_all(str,"#","\#")
    draw_set_alpha(1)
    draw_text(x+60, y+ysize-13, str);
    if (isTyping = CHAT_PRIV_MESSAGE)
        draw_text(x+10, y+ysize-13, "(TEAM)");
    if (isTyping = CHAT_PUBLIC_MESSAGE)
        draw_text(x+10, y+ysize-13, "(ALL)");
}

var message, shortMessage, color, offset, drawn_text;
draw_set_font(global.gg2Font)
draw_set_alpha(1)
var message;
for(i=0; i&lt;ds_list_size(chatLog); i+=1)
{
    //message = ds_list_find_value(chatLog, ds_list_size(chatLog)-1-i)
    message = ds_list_find_value(chatLog, i)
    switch string_copy(message, 0, 3)
    {
        case "/:/":// If a color-code was included.
            draw_set_color(getColorCode(string_copy(message, 4, COLOR_RGB_LENGTH)))
            draw_text(x+10, y+ysize-45-12*(ds_list_size(chatLog)-i), string_copy(message, prefixLength + 1, string_length(message)));
            break

        default:
            draw_set_color(c_white);
            draw_text(x+10, y+ysize-45-12*(ds_list_size(chatLog)-i), message);
            break
    }
}
draw_set_font(global.gg2Font)
draw_set_color(c_white);
</argument>
      </arguments>
    </action>
  </actions>
</event>
